<div class="split-sheet edit-view-mode">
    <form [formGroup]="createSplitSheetForm">
        <div class="acr-box mb-3">
            <div class="acr-input-label required">Your Track ISRC Code</div>
            <input type="text" id="isrc-code" formControlName="isrc" class="form-control acr-input"
                placeholder="ISRC Code" autocomplete="off">
            @if (createSplitSheetForm.get('isrc')?.errors?.['pattern']) {
            <div class="text-danger mt-1">
                Please enter valid ISRC code.
            </div>
            }
        </div>

        <!-- Publish -->
        @if (publishing_splits) {
        <div class="acr-box mb-3" formArrayName="publishing_splits">
            <div>
                <label class="acr-input-label">Publishing Splits</label>
                @for (publishingGroup of publishing_splits.controls; let i = $index; track publishingGroup)
                {
                <div class="row g-2 mb-2" [formGroupName]="i">
                    <div class="col-xl-3 col-sm-4 col-12">
                        <input type="text" formControlName="name" class="form-control acr-input" placeholder="Legal Full Name"
                            autocomplete="off">
                    </div>
                    <div class="col-xl-3 col-sm-4 col-12">
                        <acrylic-custom-dropdown
                         [inputValue]="publishingGroup.get('role')?.value" 
                         [values]="publishing_splits_role"
                         [placeholder]="'Role'"
                         [showSearch]="false"
                        (dropdownSelected)="publishingSplitsRole($event, i)"></acrylic-custom-dropdown>
                    </div>
                    <div class="col-xl-3 col-sm-4 col-12">
                        <input type="text" formControlName="email" class="form-control acr-input" placeholder="Email"
                            autocomplete="off">
                        @if(publishingGroup.get('email')?.invalid && (publishingGroup.get('email')?.dirty ||
                        publishingGroup.get('email')?.touched)) {
                        <div class="acr-input-label small text-danger">
                            <div> Please enter valid email. </div>
                        </div>
                        }
                    </div>
                    <div class="col-xl-2 col-sm-4" [ngClass]="{'col-12': i == 0, 'col-9': i !== 0}">
                        <div class="small position-relative">
                            <input type="number" formControlName="percent" class="form-control acr-input" step=".01"
                            (input)="onPercentChange('publishing_splits')">
                            <span class="text-info position-absolute top-35 right-10">%</span>
                        </div>
                    </div>
                    <div class="col-md-1 col-3 d-flex-center align-items-start pt-1" [ngClass]="{'d-none': i == 0}">
                        <button class="btn btn-sm btn-acrylic py-2" (click)="removePublishSplits(i)">
                            <img [src]="'assets/images/icons/delete.svg'" height="20" width="20" />
                        </button>
                    </div>
                </div>
                }
                <div class="row">
                    <div class="col-xl-11 col-12">
                        <div class="py-2">
                            <div class="progress my-4 overflow-visible height-1" role="progressbar"
                                aria-label="Basic example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar bg-info overflow-visible" style="width: 100%">
                                    <div class="plus-icon">
                                        <span (click)="addPublishingSheet()"
                                            class="bg-info rounded-circle d-inline-flex d-flex-center cursor-pointer height-36 width-36">
                                            <img src="assets/images/icons/plus.svg" width="20" height="20">
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div><span class="text-light-gray me-1">Total:</span> 
                    <span>{{totalPublishingSplits}}%</span>
                    @if (totalPublishingSplits != 100) {
                        <small class="text-danger ms-2">*Percentage must be equal to 100.</small>
                    }
                </div>
            </div>
        </div>
        }
        <!-- Master -->
        @if (master_splits) {
        <div class="acr-box mb-3" formArrayName="master_splits">
            <div>
                <label class="acr-input-label">Masters Splits</label>
                @for (masteringGroup of master_splits.controls; let i = $index; track masteringGroup)
                {
                <div class="row g-2 mb-2" [formGroupName]="i">
                    <div class="col-xl-3 col-sm-4 col-12">
                        <input type="text" formControlName="name" class="form-control acr-input" placeholder="Legal Full Name"
                            autocomplete="off">
                    </div>
                    
                    <div class="col-xl-3 col-sm-4 col-12">
                        <acrylic-custom-dropdown
                        [inputValue]="masteringGroup.get('role')?.value" 
                         [values]="master_splits_role"
                         [placeholder]="'Role'"
                         [showSearch]="false"
                        (dropdownSelected)="masterSplitsRole($event, i)"></acrylic-custom-dropdown>
                    </div>

                    <div class="col-xl-3 col-sm-4 col-12">
                        <input type="text" formControlName="email" class="form-control acr-input" placeholder="Email"
                            autocomplete="off">
                        @if(masteringGroup.get('email')?.invalid && (masteringGroup.get('email')?.dirty ||
                        masteringGroup.get('email')?.touched)) {
                        <div class="acr-input-label small text-danger">
                            <div> Please enter valid email. </div>
                        </div>
                        }
                    </div>

                    <div class="col-xl-2 col-sm-4" [ngClass]="{'col-12': i == 0, 'col-9': i !== 0}">
                        <div class="small position-relative">
                            <input type="number" formControlName="percent" class="form-control acr-input" step=".01"
                             (input)="onPercentChange('master_splits')">
                            <span class="text-info position-absolute top-35 right-10">%</span>
                        </div>
                    </div>
                    <div class="col-md-1 col-3 d-flex-center align-items-start pt-1" [ngClass]="{'d-none': i == 0}">
                        <button class="btn btn-sm btn-acrylic py-2" (click)="removeMasterSplits(i)">
                            <img [src]="'assets/images/icons/delete.svg'" height="20" width="20" />
                        </button>

                    </div>
                </div>
                }
                <div class="row">
                    <div class="col-xl-11 col-12">
                        <div class="py-2">
                            <div class="progress my-4 overflow-visible height-1" role="progressbar"
                                aria-label="Basic example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar bg-info overflow-visible" style="width: 100%">
                                    <div class="plus-icon">
                                        <span (click)="addMasterSheet()"
                                            class="bg-info rounded-circle d-inline-flex d-flex-center cursor-pointer height-36 width-36">
                                            <img src="assets/images/icons/plus.svg" width="20" height="20">
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div><span class="text-light-gray me-1">Total:</span> 
                    <span>{{totalMasterSplits}}%</span>
                    @if (totalMasterSplits != 100) {
                        <small class="text-danger ms-2">*Percentage must be equal to 100.</small>
                    }
                </div>
            </div>
        </div>
        }

        <!-- Review -->
        <div class="mb-4">
            <div class="d-flex-center gap-2">
                <button class="btn btn-acrylic px-4 px-lg-5 py-2 light-gray-border" (click)="navigateToHome()">
                    Back
                </button>
                <button class="btn btn-info px-4 px-lg-5 py-2 light-gray-border" (click)="reviewSheet()"
                    [disabled]="createSplitSheetForm.invalid || totalMasterSplits != 100 || totalPublishingSplits != 100"> Review </button>
            </div>
        </div>
    </form>

</div>